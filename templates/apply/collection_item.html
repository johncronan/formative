{% load patched_widget_tweaks %}
{% load form_block %}
{% load utils %}

{% with styles=form_block.form.label_class.LabelStyle %}
      <tr class="mdc-data-table__row"
          data-block-id="{{ form_block.pk }}"
          data-id="{{ item|underscore:'id' }}">
      {% if form_block.items_sortable %}
        <td class="rp-sort-handle-cell mdc-data-table__cell">
          <button type="button" class="mdc-icon-button material-icons">
            <div class="mdc-icon-button__ripple"></div>
            unfold_more
          </button>
        </td>
      {% endif %}
{% with error=item|underscore:'error' file=item|underscore:'file' %}
  {% item_columns item form_block new_file as columns %}
    {% with hide=columns.fields|yesno:', style="display: none;"'|safe %}
      {% for name, span in form_block.collection_fields_with_spans %}
        <td class="rp-item-field-cell mdc-data-table__cell"
          style="width: {{ span }}%;"
          {% if not columns.upload and forloop.counter == 1 %}
            colspan="2"
          {% else %}
            colspan="1"
          {% endif %}{{ hide }}>
          <label class="rp-item-field mdc-text-field mdc-text-field--filled">
            <span class="mdc-text-field__ripple"></span>
        {% with flabels=labels|for_item_field:name %}
          {% with wl=flabels|get_by_style:styles.WIDGET %}
            <span class="mdc-floating-label">{{ wl.text|default:name }}</span>
          {% endwith %}
        {% endwith %}
            <input class="mdc-text-field__input" type="text" name="test" />
            <span class="mdc-line-ripple"></span>
          </label>
        </td>
      {% empty %}
        <td class="rp-item-field-cell mdc-data-table__cell"
          {% if not columns.upload %}colspan="2"{% else %}colspan="1"{% endif %}
            {{ hide }}>
        {% if item|underscore:'filesize' %}
          <span class="rp-done-icon material-icons">
            download_done
          </span>
          <span style="line-height: 48px;">
            ({{ item|underscore:'filesize' }} bytes)
          </span>
        {% endif %}
        </td>
      {% endfor %}
    {% endwith %}
    {% if form_block.has_file %}
      {% with hide=columns.progress|yesno:', style="display: none;"'|safe %}
        <td class="rp-item-progress-cell mdc-data-table__cell"
            colspan="{{ form_block.total_colspan|add:1 }}"{{ hide }}>
          <div class="rp-progress-bar rp-progress-rounded">
            <div class="rp-progress-percentage rp-progress-rounded
                        mdc-theme--primary-bg" style="width: 0;">
              <span>0%</span>
            </div>
          </div>
        </td>
      {% endwith %}
      {% with hide=columns.message|yesno:', style="display: none;"'|safe %}
        <td class="rp-item-message-cell mdc-data-table__cell"
            colspan="{{ form_block.total_colspan }}"{{ hide }}>
          <span class="rp-item-error">
            {% if not hide %}{{ item|underscore:'message' }}{% endif %}
          </span>
        </td>
      {% endwith %}
      {% if error or form_block.file_optional %}
        {% with hide=columns.upload|yesno:', style="display: none;"'|safe %}
        <td class="rp-item-action-cell rp-item-upload-action
                   mdc-data-table__cell"{{ hide }}>
          <button class="rp-item-upload mdc-icon-button material-icons"
                  type="button">
            <div class="mdc-icon-button__ripple"></div>
            upload
          </button>
          <input type="file" name="itemfile{{ item|underscore:'id' }}"
                 style="display: none;"/>
        </td>
        {% endwith %}
      {% endif %}
    {% endif %}
    {% if not form_block.fixed %}
        <td class="rp-item-action-cell mdc-data-table__cell">
          <button class="rp-item-remove mdc-icon-button material-icons"
                  type="button">
            <div class="mdc-icon-button__ripple"></div>
            clear
          </button>
        </td>
    {% endif %}
{% endwith %}
      </tr>
{% endwith %}
